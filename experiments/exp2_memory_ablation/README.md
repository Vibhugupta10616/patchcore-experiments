# Experiment 2: Adaptive Coreset Sampling

**Objective**: Compare variance-weighted k-center coreset sampling (v2) vs random k-center baseline (v1) for memory-efficient anomaly detection.

---

## Results Overview

**Performance**: v1 AUROC 0.9272 | v2 AUROC 0.9271 | **-0.01% (essentially tied)**

### Per-Category Results
| Category | v1 AUROC | v2 AUROC | Improvement |
|----------|----------|----------|-------------|
| Bottle | 0.9205 | 0.9258 | +0.57% |
| Cable | 0.9224 | 0.9287 | +0.68% |
| Leather | 0.9264 | 0.9301 | +0.40% |
| Screw | 0.9379 | 0.9298 | -0.86% |
| Hazelnut | 0.9288 | 0.9211 | -0.83% |

### By Compression Level
| Size | v1 AUROC | v2 AUROC | Improvement |
|------|----------|----------|-------------|
| 0.5% | 0.9274 | 0.9255 | -0.20% |
| 1.0% | 0.9296 | 0.9280 | -0.18% |
| 5.0% | 0.9246 | 0.9278 | +0.35% |

---

## Visualizations

Three simple plots are generated by `exp2_visualize.py`:

1. **01_main_comparison.png** - AUROC vs compression level (line plot)
2. **02_category_performance.png** - Per-category AUROC (bar chart)
3. **03_improvement_percentage.png** - v2 improvement over v1 (bar chart)

Plus **exp2_summary.txt** with detailed statistics breakdown.

---

## Algorithm Comparison

### v1: Random K-Center (Baseline)
- Uniform random patch selection
- No variance analysis

### v2: Variance-Weighted K-Center (Proposed)
- Selects patches with high feature variance
- Category-specific adaptive weighting
- Maintains coreset diversity and representativeness

---

## Key Findings

✅ **Mixed performance across categories** - v2 shows improvements on some categories (+0.68% Cable, +0.57% Bottle) but degrades on others (-0.86% Screw, -0.83% Hazelnut)  
✅ **Overall performance essentially tied** (-0.01% difference)  
✅ **Largest improvement at 5% compression** (+0.35%) vs degradation at smaller compression levels (-0.20%, -0.18%)  
✅ **Maintains AUROC > 0.92** across all compression levels  
✅ **Trade-off between categories** - variance-weighted approach benefits some categories while hurting others depending on feature distribution characteristics

---

## Files (Exp2)

| File | Purpose |
|------|---------|
| scripts/exp2_main.py | Runs both methods across compression levels; produces results CSV |
| scripts/exp2_utils.py | v1 (random) and v2 (variance-weighted) sampling algorithms |
| scripts/exp2_config.yaml | Config: methods, compression ratios (0.5%, 1%, 5%), MVTec categories |
| scripts/exp2_visualize.py | Generates 3 plots + exp2_summary.txt from results CSV |
| results/results_all_methods.csv | Results table: 30 rows (5 cat × 3 sizes × 2 methods) |
| visualizations/01_main_comparison.png | Line plot: AUROC vs compression % (v1 vs v2) |
| visualizations/02_category_performance.png | Bar chart: per-category mean AUROC (v1 vs v2) |
| visualizations/03_improvement_percentage.png | Bar chart: v2 % improvement over v1 by category |
| logs/exp2_summary.txt | Text summary with statistics by category and compression level |
| logs/exp2_improved_scaling.log | Execution log from exp2_main.py run |
